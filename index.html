<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç™½å›¢å­ Companion</title>
    <style>
        :root {
            --spirit-main: #ffffff;
            --mouth-color: #475569;
            --blush-color: #fecaca;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            background: #0f172a; /* é»˜è®¤æ·±è‰² */
            color: white;
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            transition: background 1.5s ease; /* èƒŒæ™¯åˆ‡æ¢åŠ¨ç”» */
        }

        #stars-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }

        /* ---------------- é¡¶éƒ¨ UI ---------------- */
        .top-ui {
            position: absolute; top: 20px; width: 90%; 
            display: flex; justify-content: space-between; align-items: center; z-index: 500;
        }
        .memory-badge {
            font-size: 0.75rem; opacity: 0.8; line-height: 1.6;
            background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 12px;
            backdrop-filter: blur(5px);
        }
        
        .right-tools { display: flex; gap: 12px; align-items: center; }
        .tool-container { position: relative; }

        .tool-btn {
            width: 45px; height: 45px; background: rgba(255,255,255,0.1);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.2rem; border: 1px solid rgba(255,255,255,0.2);
            transition: 0.3s;
        }

        .pop-menu {
            position: absolute; top: 55px; right: 0; 
            background: rgba(255,255,255,0.98); color: #1e293b;
            padding: 12px; border-radius: 18px; display: none;
            flex-direction: column; gap: 8px; min-width: 130px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: fadeIn 0.2s forwards;
            z-index: 1000;
        }
        .menu-item {
            display: flex; align-items: center; gap: 10px; cursor: pointer;
            padding: 10px; border-radius: 12px; transition: 0.2s; font-size: 0.9rem;
            white-space: nowrap;
        }
        .menu-item:hover { background: rgba(0,0,0,0.05); }

        /* ---------------- æ ¸å¿ƒèˆå° ---------------- */
        .main-stage {
            position: relative; flex: 1; width: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10; padding-bottom: 80px;
        }

        #focus-timer { font-size: 2.5rem; font-weight: 200; margin-bottom: 20px; letter-spacing: 2px; display: none; }
        .cushion { position: absolute; bottom: -15px; width: 160px; height: 30px; background: rgba(255,255,255,0.15); border-radius: 50%; filter: blur(5px); display: none; }

        .speech-bubble {
            background: rgba(255, 255, 255, 0.95);
            color: #1e293b; padding: 15px 25px; border-radius: 25px;
            font-size: 1rem; margin-bottom: 60px; min-height: 64px;
            max-width: 85%; text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            position: relative; opacity: 0; transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s; line-height: 1.5; z-index: 20;
        }
        .speech-bubble::after {
            content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid white;
        }

        /* ---------------- å›¢å­åŠ¨ç”» ---------------- */
        .tilt-box { position: relative; transition: transform 0.2s ease-out; perspective: 600px; z-index: 10; }
        .spirit {
            width: 135px; height: 115px; background: var(--spirit-main); border-radius: 50% 50% 45% 45%;
            position: relative; box-shadow: 0 0 35px rgba(255,255,255,0.2); cursor: pointer;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.5s;
        }

        .breath-inhale { transition: transform 4s ease-in-out !important; transform: scale(1.6) !important; }
        .breath-hold { transition: transform 2s ease-in-out !important; transform: scale(1.6) !important; }
        .breath-exhale { transition: transform 6s ease-in-out !important; transform: scale(1.0) !important; }

        @keyframes munch-body { 0%, 100% { transform: scale(1, 1); } 50% { transform: scale(1.18, 0.88); } }
        @keyframes munch-mouth { 0%, 100% { height: 2px; width: 12px; } 50% { height: 14px; width: 18px; } }
        @keyframes swallow-gulp { 0% { transform: scale(1.18, 0.88); } 50% { transform: scale(0.85, 1.25) translateY(-25px); } 100% { transform: scale(1, 1) translateY(0); } }

        .munching { animation: munch-body 0.4s infinite !important; }
        .munching .mouth { animation: munch-mouth 0.4s infinite !important; border: none !important; background: var(--mouth-color); border-radius: 50%; }
        .swallowing { animation: swallow-gulp 0.6s ease-out forwards !important; }

        .face { position: absolute; top: 40px; width: 100%; pointer-events: none; }
        .eyes-row { display: flex; justify-content: center; gap: 35px; margin-bottom: 15px; }
        .eye { width: 8px; height: 8px; background: #334155; border-radius: 50%; transition: 0.2s; }
        .eye.happy { transform: scaleY(0.2) translateY(5px) !important; }
        .eye.focusing { transform: scaleY(0.5); }

        .blush-row { position: absolute; top: 12px; width: 100%; display: flex; justify-content: center; gap: 55px; opacity: 0.3; }
        .blush { width: 15px; height: 8px; background: var(--blush-color); border-radius: 50%; filter: blur(2px); transition: 0.5s; }
        .blush.shy { opacity: 1; transform: scale(1.4); background: #fca5a5; }

        .mouth {
            position: absolute; top: 28px; left: 50%; transform: translateX(-50%);
            width: 14px; height: 7px; border-bottom: 2.5px solid var(--mouth-color);
            border-radius: 0 0 10px 10px; transition: all 0.3s;
        }
        .mouth.open { top: 22px; width: 28px; height: 28px; background: #334155; border: none; border-radius: 50%; box-shadow: inset 0 -6px 0 #fca5a5; }

        /* ---------------- UI ç»„ä»¶ ---------------- */
        #onboarding { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 30px; }
        .input-box { width: 100%; max-width: 280px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 15px; color: white; padding: 12px; font-size: 1rem; text-align: center; margin-bottom: 15px; }
        .action-btn { background: white; color: #1e293b; border: none; padding: 10px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; transition: 0.3s; }

        .dock { position: fixed; bottom: 30px; display: flex; gap: 15px; background: rgba(255,255,255,0.08); padding: 10px 20px; border-radius: 40px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); z-index: 100; }
        .dock-item { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 50%; cursor: pointer; font-size: 1.3rem; transition: 0.3s; opacity: 0.6; }
        .dock-item.active { opacity: 1; background: rgba(255,255,255,0.2); }

        .gift-cloud, .trouble-cloud { position: fixed; padding: 8px 15px; border-radius: 20px; z-index: 2000; transition: all 1s cubic-bezier(0.6, -0.28, 0.735, 0.045); pointer-events: none; }
        .gift-cloud { background: white; color: #1e293b; }
        .trouble-cloud { background: rgba(148, 163, 184, 0.9); color: white; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="stars-container"></div>
    
    <div class="top-ui">
        <div class="memory-badge" id="memory-badge">
            <span id="badge-name">...</span><br>
            é™ªä¼´: <span id="badge-days">1</span> å¤© | æ˜Ÿæ˜Ÿ: <span id="badge-stars">0</span>
        </div>
        <div class="right-tools">
            <div class="tool-container">
                <div class="tool-btn" onclick="toggleMenu('bag-menu')">ğŸ’</div>
                <div id="bag-menu" class="pop-menu">
                    <div class="menu-item" onclick="giveGift('ğŸª', 'å°é¥¼å¹²')">ğŸª ç»™å—é¥¼å¹²</div>
                    <div class="menu-item" onclick="giveGift('ğŸµ', 'çƒ­èŒ¶')">ğŸµ å€’æ¯çƒ­èŒ¶</div>
                    <div class="menu-item" onclick="startFocus()">ğŸ“– é™ªæˆ‘ä¸“æ³¨</div>
                </div>
            </div>
            <div class="tool-container">
                <div class="tool-btn" onclick="toggleMenu('note-menu')">âœ‰ï¸</div>
                <div id="note-menu" class="pop-menu">
                    <div class="menu-item" onclick="giveNote()">âœ‰ï¸ æŠ½å¼ çº¸æ¡</div>
                </div>
            </div>
        </div>
    </div>

    <div id="onboarding">
        <h2 style="margin-bottom: 30px; font-weight: 300;">ä½ å¥½å‘€ï¼Œæˆ‘æ˜¯æ–°æ¥çš„ã€‚<br>æˆ‘è¯¥æ€ä¹ˆç§°å‘¼ä½ å‘¢ï¼Ÿ</h2>
        <input type="text" id="name-input" class="input-box" placeholder="ä½ çš„åå­—..." maxlength="8">
        <button class="action-btn" onclick="saveName()">æˆ‘ä»¬è¦ä¸€ç›´åœ¨ä¸€èµ·å“¦</button>
    </div>

    <div class="main-stage">
        <div id="focus-timer">25:00</div>
        <div class="speech-bubble" id="bubble">...</div>

        <div id="vent-area" style="display: none; flex-direction: column; align-items: center; margin-bottom: 40px; z-index: 100;">
            <input type="text" id="vent-input" class="input-box" placeholder="æŠŠçƒ¦æ¼å†™åœ¨è¿™é‡Œ..." autocomplete="off">
            <button class="action-btn" onclick="startSwallowing()">äº¤ç»™å›¢å­åƒæ‰</button>
        </div>

        <div class="tilt-box" id="tilt-box">
            <div class="cushion" id="cushion"></div>
            <div class="spirit" id="spirit" onclick="handlePet()">
                <div class="face">
                    <div class="eyes-row">
                        <div class="eye"></div>
                        <div class="eye"></div>
                    </div>
                    <div class="blush-row"><div class="blush"></div><div class="blush"></div></div>
                    <div class="mouth" id="mouth"></div>
                </div>
            </div>
        </div>
    </div>

    <button id="exit-focus" class="action-btn" style="position: fixed; bottom: 100px; display: none; z-index: 1000;" onclick="stopFocus()">ä¸å­¦å•¦ï¼ŒæŠ±æŠ±æˆ‘</button>

    <div class="dock" id="main-dock">
        <div class="dock-item active" onclick="switchMode('idle', this)">ğŸ </div>
        <div class="dock-item" onclick="switchMode('breath', this)">ğŸŒ¬ï¸</div>
        <div class="dock-item" onclick="switchMode('vent', this)">ğŸ•³ï¸</div>
        <div class="dock-item" onclick="switchMode('sleep', this)">ğŸŒ™</div>
    </div>

    <script>
        const Memory = {
            init: () => { if(!localStorage.getItem('spirit_meet_date')) localStorage.setItem('spirit_meet_date', new Date().getTime()); },
            getUserName: () => localStorage.getItem('spirit_name'),
            setUserName: (n) => localStorage.setItem('spirit_name', n),
            getStars: () => parseInt(localStorage.getItem('spirit_stars') || 0),
            addStar: () => { const s = Memory.getStars() + 1; localStorage.setItem('spirit_stars', s); return s; },
            getDays: () => { const meet = localStorage.getItem('spirit_meet_date'); return Math.floor((new Date().getTime() - meet) / (1000 * 60 * 60 * 24)) + 1; },
            refreshBadge: () => {
                const name = Memory.getUserName();
                if(name) {
                    document.getElementById('memory-badge').style.opacity = 1;
                    document.getElementById('badge-name').innerText = name + " çš„é™ªä¼´è€…";
                    document.getElementById('badge-stars').innerText = Memory.getStars();
                    document.getElementById('badge-days').innerText = Memory.getDays();
                }
            }
        };

        const spirit = document.getElementById('spirit');
        const bubble = document.getElementById('bubble');
        const mouth = document.getElementById('mouth');
        const ventArea = document.getElementById('vent-area');
        const eyes = document.querySelectorAll('.eye');
        const blushes = document.querySelectorAll('.blush');
        
        let currentMode = 'idle';
        let breathTimer = null;
        let focusInt = null;

        window.onload = () => { Memory.init(); createStars(); updateTimeTheme(); if (!Memory.getUserName()) document.getElementById('onboarding').style.display = 'flex'; else welcomeUser(); };

        function toggleMenu(id) {
            const menu = document.getElementById(id);
            const isVisible = menu.style.display === 'flex';
            document.querySelectorAll('.pop-menu').forEach(m => m.style.display = 'none');
            menu.style.display = isVisible ? 'none' : 'flex';
        }

        function showMessage(txt) {
            bubble.style.opacity = 0; bubble.style.transform = "translateY(10px)";
            setTimeout(() => { bubble.innerText = txt; bubble.style.opacity = 1; bubble.style.transform = "translateY(0)"; }, 300);
        }

        // --- æ ¸å¿ƒä¿®å¤ï¼šæ—¶ç©ºèƒŒæ™¯æ£€æŸ¥ ---
        function updateTimeTheme() {
            const h = new Date().getHours();
            let b = "";
            if (h >= 5 && h < 9) b = "linear-gradient(180deg, #ff9a9e 0%, #fad0c4 100%)"; // æ™¨æ›¦
            else if (h >= 9 && h < 17) b = "linear-gradient(180deg, #a1c4fd 0%, #c2e9fb 100%)"; // ç™½æ˜¼
            else if (h >= 17 && h < 20) b = "linear-gradient(180deg, #f6d365 0%, #fda085 100%)"; // é»„æ˜
            else b = "linear-gradient(180deg, #0f172a 0%, #1e293b 100%)"; // æ·±å¤œ
            document.body.style.background = b;
        }

        // --- æ¨¡å¼åˆ‡æ¢ä¿®å¤ ---
        function switchMode(mode, el) {
            clearTimeout(breathTimer); currentMode = mode;
            spirit.className = 'spirit'; spirit.style.transform = ""; 
            ventArea.style.display = 'none';
            document.querySelectorAll('.dock-item').forEach(d => d.classList.remove('active'));
            el.classList.add('active');

            // åªè¦ä¸æ˜¯ç‚¹å‡»æ™šå®‰ï¼Œå°±é‡æ–°æ£€æŸ¥ä¸€æ¬¡æ—¶é—´å¹¶æ¢å¤èƒŒæ™¯
            if (mode !== 'sleep') {
                updateTimeTheme();
            }

            if(mode === 'idle') welcomeUser();
            else if(mode === 'breath') runBreath();
            else if(mode === 'vent') { ventArea.style.display = 'flex'; showMessage("æŠŠçƒ¦æ¼å†™ä¸‹æ¥ï¼Œæˆ‘å¸®ä½ åƒæ‰ã€‚"); }
            else if(mode === 'sleep') { 
                document.body.style.background = "#020617"; // æ™šå®‰æ¨¡å¼ä¸“ç”¨æ·±é»‘
                spirit.classList.add('sleeping'); 
                showMessage("æ™šå®‰ï¼Œæˆ‘ä¼šå®ˆç€ä½ çš„ã€‚"); 
            }
        }

        function runBreath() {
            if(currentMode !== 'breath') return;
            const cycle = () => {
                if(currentMode !== 'breath') return;
                showMessage("æ…¢æ…¢å¸æ°”...");
                spirit.className = 'spirit breath-inhale';
                breathTimer = setTimeout(() => {
                    if(currentMode !== 'breath') return;
                    showMessage("åœä½ä¸€ä¼šå„¿...");
                    spirit.className = 'spirit breath-hold';
                    breathTimer = setTimeout(() => {
                        if(currentMode !== 'breath') return;
                        showMessage("ç¼“ç¼“å‘¼æ°”...");
                        spirit.className = 'spirit breath-exhale';
                        breathTimer = setTimeout(cycle, 6000);
                    }, 2000);
                }, 4000);
            };
            cycle();
        }

        function startFocus() {
            toggleMenu('bag-menu'); currentMode = 'focus';
            document.getElementById('main-dock').style.display = 'none';
            document.getElementById('focus-timer').style.display = 'block';
            document.getElementById('exit-focus').style.display = 'block';
            document.getElementById('cushion').style.display = 'block';
            spirit.style.transform = "scale(0.8)";
            eyes.forEach(e => e.classList.add('focusing'));
            updateTimeTheme(); 
            showMessage("åŠ æ²¹ï¼Œæˆ‘ä¼šé™ªç€ä½ çš„ã€‚");
            let timeLeft = 25 * 60;
            focusInt = setInterval(() => {
                timeLeft--;
                const m = Math.floor(timeLeft / 60); const s = timeLeft % 60;
                document.getElementById('focus-timer').innerText = `${m}:${s < 10 ? '0' + s : s}`;
                if(timeLeft <= 0) stopFocus(true);
            }, 1000);
        }

        function stopFocus(finished = false) {
            clearInterval(focusInt);
            document.getElementById('main-dock').style.display = 'flex';
            document.getElementById('focus-timer').style.display = 'none';
            document.getElementById('exit-focus').style.display = 'none';
            document.getElementById('cushion').style.display = 'none';
            spirit.style.transform = ""; eyes.forEach(e => e.classList.remove('focusing'));
            updateTimeTheme(); 
            if(finished) { showMessage("å¤ªæ£’äº†ï¼ä¸“æ³¨ç»“æŸï¼ŒæŠ±æŠ±ã€‚"); createBurstEffect(); }
            else showMessage("å¥½å“’ï¼Œé‚£æˆ‘ä»¬å…ˆä¼‘æ¯ä¸€ä¼šå„¿ã€‚");
            currentMode = 'idle';
        }

        // --- äº’åŠ¨ä¸è¿›é£Ÿé€»è¾‘ ---
        function runEatInteraction(callback) {
            spirit.classList.add('munching');
            eyes.forEach(e => e.classList.add('happy'));
            setTimeout(() => {
                spirit.classList.remove('munching');
                spirit.classList.add('swallowing');
                setTimeout(() => {
                    spirit.classList.remove('swallowing');
                    mouth.classList.remove('open');
                    if(callback) callback();
                    setTimeout(() => eyes.forEach(e => e.classList.remove('happy')), 1500);
                }, 600);
            }, 2000); 
        }

        function giveGift(emoji, name) {
            toggleMenu('bag-menu');
            showMessage(`${Memory.getUserName()} é€äº†æˆ‘${name}ï¼Œå¥½é¦™å‘€ï¼`);
            mouth.classList.add('open');
            const gift = document.createElement('div');
            gift.className = 'gift-cloud'; gift.innerText = emoji;
            gift.style.right = '40px'; gift.style.top = '40px';
            document.body.appendChild(gift);
            setTimeout(() => {
                const sRect = spirit.getBoundingClientRect();
                gift.style.left = (sRect.left + 50) + 'px'; gift.style.top = (sRect.top + 50) + 'px';
                gift.style.transform = "scale(0.1)"; gift.style.opacity = "0";
            }, 100);
            setTimeout(() => { gift.remove(); runEatInteraction(() => { blushes.forEach(b => b.classList.add('shy')); setTimeout(() => blushes.forEach(b => b.classList.remove('shy')), 2000); }); }, 1000);
        }

        function startSwallowing() {
            const input = document.getElementById('vent-input');
            const txt = input.value.trim();
            if(!txt) return;
            mouth.classList.add('open');
            showMessage("å•Šâ€”â€”å‘œï¼å…¨åƒæ‰ï¼");
            const rect = input.getBoundingClientRect();
            const cloud = document.createElement('div');
            cloud.className = 'trouble-cloud'; cloud.innerText = txt;
            cloud.style.left = rect.left+'px'; cloud.style.top = rect.top+'px';
            document.body.appendChild(cloud);
            setTimeout(() => {
                const sRect = spirit.getBoundingClientRect();
                cloud.style.left = (sRect.left + 50) + 'px'; cloud.style.top = (sRect.top + 50) + 'px';
                cloud.style.transform = "scale(0.1)"; cloud.style.opacity = "0";
            }, 50);
            setTimeout(() => { cloud.remove(); input.value = ""; runEatInteraction(() => { const stars = Memory.addStar(); Memory.refreshBadge(); showMessage(`å¥½å•¦ï¼Œçƒ¦æ¼æ¶ˆåŒ–æ‰å•¦ã€‚è¿™æ˜¯ç¬¬ ${stars} é¢—å®ˆæŠ¤æ˜Ÿã€‚`); createBurstEffect(); }); }, 850);
        }

        function handlePet() {
            if(currentMode === 'breath' || currentMode === 'focus') return;
            spirit.style.transform = "scale(1.1) translateY(-10px)";
            blushes.forEach(b => b.classList.add('shy'));
            showMessage("è¹­è¹­~ è¢«ä½ æ‘¸æ‘¸å¥½èˆ’æœã€‚");
            setTimeout(() => { if(currentMode === 'idle') spirit.style.transform = ""; blushes.forEach(b => b.classList.remove('shy')); }, 800);
        }

        // --- æŠ½å¼ çº¸æ¡åŠŸèƒ½å‡çº§ç‰ˆï¼š30æ¡è¶…çº§æ²»æ„ˆå†…å®¹ ---
        function giveNote() {
            toggleMenu('note-menu');
            const ns = [
                "ä½ å·²ç»å¾ˆæ£’äº†ï¼Œå“ªæ€•ä»Šå¤©åªæ˜¯å®‰é™åœ°å¾…ç€ã€‚",
                "å…è®¸è‡ªå·±åœä¸‹æ¥ï¼Œæ˜¯å‹‡æ°”ï¼Œä¹Ÿæ˜¯æ™ºæ…§ã€‚",
                "ä½ ä¸éœ€è¦å‘ä»»ä½•äººè¯æ˜ä½ çš„ä»·å€¼ã€‚",
                "ä½ çš„å­˜åœ¨æœ¬èº«ï¼Œå°±æ˜¯ä¸€ä»¶å¾ˆç¾å¥½çš„äº‹ã€‚",
                "æ…¢æ…¢æ¥ä¹Ÿæ²¡å…³ç³»ï¼Œæ¯æœµèŠ±éƒ½æœ‰è‡ªå·±çš„èŠ±æœŸã€‚",
                "ä»Šå¤©çš„ä½ ï¼Œå·²ç»ä¸ºä»Šå¤©åšåˆ°è¶³å¤Ÿå¤šäº†ã€‚",
                "éš¾è¿‡çš„æ—¶å€™ï¼Œå°±æŠ±æŠ±è‡ªå·±ï¼Œæˆ‘ä¼šä¸€ç›´é™ªç€ä½ ã€‚",
                "æ²¡å…³ç³»çš„ï¼Œä½ å¯ä»¥å“­ï¼Œä¹Ÿå¯ä»¥è½¯å¼±ä¸€ä¼šå„¿ã€‚",
                "å¤–é¢çš„ä¸–ç•Œå¾ˆåµï¼Œä½†è¿™é‡Œæ°¸è¿œä¸ºä½ ç•™äº†ä¸€ç‰‡å®é™ã€‚",
                "ç´¯äº†å°±é—­ä¸Šçœ¼ï¼ŒæŠŠçƒ¦æ¼äº¤ç»™æˆ‘ï¼Œæˆ‘å¸®ä½ å®ˆç€ã€‚",
                "ä½ ä¸æ˜¯ä¸€ä¸ªäººåœ¨é¢å¯¹ï¼Œæˆ‘åœ¨è¿™é‡Œï¼Œæ°¸è¿œåœ¨ã€‚",
                "è¯·å¯¹è‡ªå·±å†æ¸©æŸ”ä¸€ç‚¹å§ï¼Œä½ å€¼å¾—æ‰€æœ‰çš„å–„å¾…ã€‚",
                "è®°å¾—å–å£æ°´ï¼Œæ»‹æ¶¦ä¸€ä¸‹ç–²æƒ«çš„å¿ƒå‘€ã€‚",
                "è¯•ç€æ·±å‘¼å¸ä¸‰æ¬¡ï¼Œæ„Ÿè§‰ç©ºæ°”å¸¦èµ°èº«ä½“çš„æ²‰é‡ã€‚",
                "å“ªæ€•åªæœ‰ä¸€ç‚¹ç‚¹è¿›æ­¥ï¼Œä¹Ÿå€¼å¾—å¥–åŠ±è‡ªå·±ä¸€ä¸ªå¾®ç¬‘ã€‚",
                "æŠŠè‚©è†€æ²‰ä¸‹æ¥ï¼Œæ”¾æ¾ä¸€ä¸‹ç´§ç»·äº†ä¸€å¤©çš„èº«ä½“å§ã€‚",
                "å»çœ‹çœ‹çª—å¤–å§ï¼Œä¸–ç•Œä¾ç„¶æœ‰å¾ˆå¤šç»†å°çš„ç¾å¥½åœ¨å‘ç”Ÿã€‚",
                "ç°åœ¨çš„å›°éš¾åªæ˜¯æš‚æ—¶çš„äº‘æœµï¼Œé˜³å…‰æ€»ä¼šç©¿é€è¿›æ¥çš„ã€‚",
                "ä½ æ¯”è‡ªå·±æƒ³è±¡çš„è¦åšéŸ§å¾—å¤šï¼ŒæŠ±æŠ±åšå¼ºçš„ä½ ã€‚",
                "è¿‡å»çš„å·²ç»è¿‡å»ï¼Œç°åœ¨çš„ä½ ä¾ç„¶æ‹¥æœ‰è¢«çˆ±çš„æƒåˆ©ã€‚",
                "ä¸è¦å› ä¸ºæ²¡åšåˆ°çš„äº‹ï¼Œè€Œå¦å®šå·²ç»ä»˜å‡ºçš„åŠªåŠ›ã€‚",
                "æ—©ç‚¹ç¡å§ï¼Œæ˜å¤©çš„å¤ªé˜³ä¼šå¸¦ç»™ä½ æ–°çš„åŠ›é‡ã€‚",
                "æˆ‘åœ¨ä½ çš„å°ä¹¦åŒ…é‡Œå·å·è—äº†ä¸€é¢—æ˜Ÿæ˜Ÿï¼Œé€ç»™ä½ ã€‚",
                "ç»™ä½ ä¸€ä¸ªéš”ç€å±å¹•çš„å¤§å¤§å¤§å¤§çš„æ‹¥æŠ±ï¼æ¥æ”¶åˆ°äº†å—ï¼Ÿ",
                "å›¢å­ä¼šä¸€ç›´åœ¨è¿™é‡Œç­‰ä½ çš„ï¼Œéšæ—¶å›æ¥éƒ½å¯ä»¥ã€‚",
                "å˜¿å˜¿ï¼Œæ‘¸æ‘¸å¤´ï¼Œæ‰€æœ‰çš„åå¿ƒæƒ…å¿«ç‚¹èµ°å¼€å‘€ã€‚",
                "æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„èŠ‚å¥ï¼Œä¸ç”¨å»è¿½èµ¶åˆ«äººçš„è„šæ­¥ã€‚",
                "å“ªæ€•ä¸–ç•Œå¶å°”ç°æš—ï¼Œä½ ä¹Ÿæ˜¯ç…§äº®æŸäººçš„é‚£æŸå…‰ã€‚",
                "ä½ çš„æ‰€æœ‰ä»˜å‡ºï¼Œæ—¶é—´éƒ½è®°å¾—ï¼Œæˆ‘ä¹Ÿä¼šè®°å¾—ã€‚",
                "æ˜å¤©åˆæ˜¯æ–°çš„ä¸€é¡µï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·é‡æ–°å¼€å§‹ã€‚"
            ];
            const randomNote = ns[Math.floor(Math.random() * ns.length)];
            showMessage(`(æ‚„æ‚„é€’è¿‡çº¸æ¡)ï¼š"${randomNote}"`);
        }

        function welcomeUser() { Memory.refreshBadge(); showMessage(`${Memory.getUserName()}ï¼Œä½ å›æ¥å•¦ï¼Œä»Šå¤©ä¹Ÿä¸€èµ·åŠ æ²¹ã€‚`); }
        function saveName() { const val = document.getElementById('name-input').value.trim(); if(val) { Memory.setUserName(val); document.getElementById('onboarding').style.display = 'none'; welcomeUser(); } }

        function createStars() {
            const c = document.getElementById('stars-container');
            for(let i=0; i<40; i++) {
                const s = document.createElement('div'); s.style.position = 'absolute'; s.style.left = Math.random()*100+'%'; s.style.top = Math.random()*100+'%'; s.style.width = '2px'; s.style.height = '2px'; s.style.background = 'white'; s.style.opacity = Math.random()*0.5; c.appendChild(s);
            }
        }
        function createBurstEffect() {
            for(let i=0; i<10; i++) {
                const p = document.createElement('div'); p.innerText = "âœ¨"; p.style.position = "fixed"; p.style.left = "50%"; p.style.top = "60%"; p.style.transition = "1.5s ease-out"; document.body.appendChild(p);
                const a = Math.random() * Math.PI * 2;
                setTimeout(() => { p.style.transform = `translate(${Math.cos(a)*150}px, ${Math.sin(a)*150}px) scale(0)`; p.style.opacity = 0; }, 50);
                setTimeout(() => p.remove(), 1500);
            }
        }

        document.addEventListener('mousemove', (e) => {
            if(currentMode === 'sleep' || currentMode === 'breath' || currentMode === 'focus') return;
            const r = spirit.getBoundingClientRect(); const cx = r.left + r.width/2; const cy = r.top + r.height/2;
            const a = Math.atan2(e.clientY - cy, e.clientX - cx);
            eyes.forEach(eye => { if(!eye.classList.contains('happy')) eye.style.transform = `translate(${Math.cos(a)*4}px, ${Math.sin(a)*4}px)`; });
            const rx = -(e.clientY - cy) / window.innerHeight * 15; const ry = (e.clientX - cx) / window.innerWidth * 15;
            document.getElementById('tilt-box').style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
        });
    </script>
</body>
</html>
